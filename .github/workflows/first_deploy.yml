name: Deploy to Google Cloud

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Google Cloud SDK
        uses: google-github-actions/setup-gcloud@v2
        with:
          service_account_key: ${{secrets.RCM_DB_SERVICE_ACCOUNT}}
          project_id: ${{secrets.GOOGLE_PROJECT_ID}}
          
      - name: Access Cloud SQL
        run: |
          # Set instance connection name
          INSTANCE_CONNECTION_NAME="smiling-audio-398006:us-central1:rcmdatabase"

          # Set database user and password
          DB_USER="sqlserver"
          DB_PASSWORD="${{secrets.RCM_DB_PASSWORD1}}"

          # Example: Run a MySQL query
          gcloud sql connect $INSTANCE_CONNECTION_NAME --user=$DB_USER --quiet --project=$project_id --password=$DB_PASSWORD
